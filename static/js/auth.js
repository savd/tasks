// Generated by CoffeeScript 1.3.3
(function() {
  var doLogin;

  $(document).onReady(function() {
    $(document).find('span.a.login')[0].on('click', function() {
      return doLogin();
    });
    return navigator.id.watch({
      loggedInUser: function() {
        return Xhr.load('/auth/get_mail', {
          onSuccess: this.text
        });
      },
      onlogin: function(assertion) {
        return Xhr.load('/auth/auth', {
          method: 'POST',
          params: {
            assertion: assertion
          },
          onSuccess: function() {
            return window.location = '/';
          },
          onFailure: function() {
            return alert('Not authorized!');
          }
        });
      },
      onlogout: function() {}
    });
  });

  doLogin = function() {
    return Xhr.load('/auth/check', {
      method: 'POST',
      params: {
        user: $('login').value()
      },
      onSuccess: function() {
        return navigator.id.request();
      },
      onFailure: function() {
        return alert(this.text);
      }
    });
  };

}).call(this);
